{% extends 'base.html' %}
{% block title %}Streaming Service • Movie Results{% endblock %}
{% block content %}
  <h1>Movies matching “{{ title }}”</h1>

  <div style="margin: 8px 0;">
    <strong>Sort:</strong>
    {% set qs = 'sort=' ~ (sort or 'popularity') ~ '&order=' ~ (order or 'desc') %}
    {% macro link(text, s, o) -%}
      <a class="btn btn-secondary" href="?sort={{ s }}&order={{ o }}">{{ text }}{% if sort==s and order==o %} ✓{% endif %}</a>
    {%- endmacro %}
    {{ link('Most popular', 'popularity', 'desc') }}
    {{ link('Least popular', 'popularity', 'asc') }}
    {{ link('Highest rated', 'rating', 'desc') }}
    {{ link('Lowest rated', 'rating', 'asc') }}
    {{ link('A–Z', 'name', 'asc') }}
    {{ link('Newest', 'year', 'desc') }}
    {{ link('Oldest', 'year', 'asc') }}
  </div>

  <div class="card" style="margin-top:8px;">
    <div class="card-inner">
      <table class="table" id="resultsTable">
        <thead>
          <tr>
            <th>Movie</th>
            <th>Year</th>
            <th>Popularity</th>
            <th>Rating</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
        {% for movie in results %}
          <tr>
            <td class="cell-title"><a href="/watch/movie/{{ movie.id }}">{{ movie.name }}</a></td>
            <td class="cell-year">{{ movie.year }}</td>
            <td class="cell-popularity">{{ movie.popularity|round(1) }}</td>
            <td class="cell-rating">
              {% set r = movie.rating|round(1) %}
              {{ r|int if r == r|int else r }}/10
            </td>
            <td class="row-actions"><a class="btn btn-secondary" href="/watch/movie/{{ movie.id }}">Watch</a></td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      <div class="pager" data-kind="movie" data-page="{{ page }}" data-title="{{ title }}" data-sort="{{ sort or 'popularity' }}" data-order="{{ order or 'desc' }}">
        <button class="btn btn-secondary" id="prev-btn" data-action="prev">Prev</button>
        <span class="badge">Page {{ page }}</span>
        <button class="btn" id="next-btn" data-action="next">Next</button>
      </div>
    </div>
  </div>
{% endblock %}